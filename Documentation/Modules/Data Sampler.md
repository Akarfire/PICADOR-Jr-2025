#Module 

### Описание модуля

Модуль `DataSampler` предназначен для сбора информации о текущем состоянии системы "частицы-поле" и сохранения её в файлы для последующей визуализации.

### Конфигурация модуля

Модуль предоставляет множество настроек, благодаря которым можно выбрать, какие конкретно данные о системе интересуют пользователя.

* `sampleInterval` - указывает интервал сбора данных в числе итераций;
* `sampleOnlySpecificIterations` - флаг, при наличии которого данные собираются только в определённые итерации, указанные в параметре `specificIterations`.

* `sampleTotalEnergy`- флаг сбора информации об общей энергии системы;
* `autoParticleTrackingIDs`- флаг автоматического добавления индексов отслеживания частицам;

* `sampleParticleLocations`- флаг сбора информации о положении частиц;
* `sampleParticleVelocities` - флаг сбора информации о скорости частиц;
* `sampleParticleCells` - флаг сбора информации об индексах ячеек, в которых находятся частицы;

* `sampleParticleDensity`- флаг сбора информации о плотности распределения частиц;

* `sampleParticleEnergy`- флаг сбора информации об общей кинетической энергии всех частиц;

* `traceExampleParticle`- флаг, при наличии которого будет выбрана случайная частица-пример. В ходе симуляции будет собираться информация о движении этой частицы;
* `exampleParticlePickingSeed`- `seed`, на основании которого выбирается частица-пример;
* `exampleTraceParticleTrackingID`- индекс отслеживания, присваиваемый частице-примеру;

* `sampleFieldData`- флаг сбора информации об электромагнитном поле;
* `sampleFieldE`-  флаг сбора информации об электрическом поле;
* `sampleFieldB`-  флаг сбора информации о магнитном поле;
* `sampleFieldJ`- флаг сбора информации о токах, создаваемых движущимися заряженными частицами;

* `sampleFieldEnergy`- флаг сбора информации об энергии поля;

* `writeParticleGridParameters` - флаг, при наличии которого в файл будет записана информация о сетке частиц;

* `fileForEveryIteration`- флаг, при наличии которого информация будет сохранятся в отдельный файл после каждой итерации, иначе - после завершения симуляции информация сохраняется в общий файл.
* `outputFileName`- путь до выходного файла;
* `perIterationOutputFileFormat`- формат файла, используемый при наличии флага `fileForEveryIteration`(т.к. к имени, указанному в `outputFileName` добавляется номер итерации).

### Формат выходного файла

~~~
Particle Grid Parameters:
Resolution X: 64
Resolution Y: 8
Delta X: 0.015625
Delta Y: 0.015625
Origin: 0, 0, 0

Iteration: 48
1 | Location: 0.838694, 0.079495, 0
1 | Velocity: -2.36382e+09, -2.1417e+09, 0
Particle Density: 
0, 0 : 7.64822e+07
...
Field Data: 
E: 0, 0 : 725.394, 140.717, 0
B: 0, 0 : 0, 0, -62.5158
J: 0, 0 : 5.90296e+12, -1.07639e+12, 0
...
Field Energy: 3.02983e+06
Particle Energy: 691.891
Total Energy: 3.03017e+06
~~~

Данные о частицах указываются в формате:

```
Индекс отслеживания | Параметр: значение
```

Данные о плотности распределения частиц указываются в формате

```
Положение в пространтсве : значение
```

Данные об электромагнитном поле указываются в формате:

```
Компонета поля: положение в пространтсве : значение
```

### Реализация

При вызове метода `onUpdate()` модуль проверяет условие сбора информации на текущей итерации. Если условие выполняется, то начинается сбор данных в соответствии с флагами конфигурации модуля. Собранные данные сохраняются в структуре массивов `SampleData`.

Информация об энергии частиц, собираемая при установленном флаге `sampleParticleEnergy`, высчитывается по следующей формуле:
$$ E_p = \sum_p\left( (\gamma_p - 1) \cdot m_p \cdot c^2 \right),$$
$$\gamma_p = \left( \sqrt{1 - \dfrac{v_p^2}{c^2}} \right)^{-1}.$$

Информация об энергии поля, собираемая при установленном флаге `sampleFieldEnergy`, высчитывается по следующей формуле:
$$ E_f = \dfrac{1}{8\pi} \sum_{i = 0}^{n_x} \sum_{j = 0}^{n_y}(E_{ij}^2 + B_{ij}^2) \Delta x \Delta y \Delta z, $$ где $n_x, n_y$ - разрешение сетки по осям $x$ и $y$ соответственно, $E_{ij}$ и $B_{ij}$ - значения электрического и магнитного поля в узле сетки поля с индексами $i, j$, $\Delta x, \ \Delta y, \ \Delta z = \Delta y$ - размеры ячейки сетки поля. 

Полная энергия системы высчитывается как сумма $E_p + E_f$.

### Ссылки
* [Module](../Basic/Module.md)
* [Auto Visualization System](../Experiments/Auto%20Visualization%20System.md)