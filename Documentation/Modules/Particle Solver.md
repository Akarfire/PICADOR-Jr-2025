#Module 

### Описание модуля

Модуль `Particle Solver` предназначен для:
* Интегрирования уравнений движения частиц по методу Бориса;
* Обработки перемещения частиц между ячейками сетки частиц (`ParticleGrid`).

### Конфигурация модуля

-
### Принцип работы

#### Определения

Решается задача численного моделирования динамики заряженных частиц в электромагнитном поле.

**Заряженная частица** определяется следующими параметрами:
* $q$ - заряд (скаляр);
* $m$ - масса (скаляр);
* $\vec{r}$ - текущее положение в пространстве (3-х мерный вектор);
* $\vec{v}$ - текущая скорость (3-х мерный вектор);
* $\vec{p}$ - импульс частицы (3-х мерный вектор).

Скорость $\vec{v}$ и импульс $\vec{p}$ равны по направлению, а их модули в релятивистском случае однозначно связаны формулой
$$ v = \dfrac{p}{m} \left( 1 + \left( \dfrac{p}{mc} \right)^2 \right)^{-\dfrac{1}{2}}, $$
где $c$ - скорость света в вакууме.

В данном случае решается двумерная версия задачи, поэтому третьи компоненты векторов $\vec{r},$ $\vec{v}$ и $\vec{p}$ считаются равными нулю.

**Электромагнитное поле** определяется тремя 2-х мерными векторами:
* $\vec{E}$ - значение электрического поля;
* $\vec{B}$ - значение магнитного поля.

#### Начальные условия

В начальный момент времени ($t = 0$) для каждой частицы определены:
* $q$ - заряд и $m$ - масса;
* $\vec{r}_0$ - начальное положение в пространстве;
* $\vec{v_0}$ - начальная скорость частицы.

#### Шаг симуляции

На каждой итерации симуляции новое положение каждой частицы высчитывается по формуле
$$ \vec{r}_{new} = \vec{r}_{old} + \vec{v}_{new} \ \Delta t, $$
где $\Delta t$ - шаг по времени между итерациями.

Следовательно, на каждой новой итерации необходимо вычислять новую скорость частицы на основании данных с предыдущей итерации и значений поля в местеположения частицы. Для этого используют **схему Бориса**.

$$ \vec{p}_{new} = mc \ \cdot \ \vec{u}_{new}; $$
$$ \vec{u}_{new} = \vec{u}^{(+)} + \dfrac{q\Delta t}{2mc}; $$
$$ \vec{u}^{(+)} = \vec{u}^{(-)} + \vec{u}^{\ `} \ \times \vec{s};$$
$$ \vec{s} = \vec{t} \cdot \dfrac{2}{1 + | \ \vec{t} \ |^2}; $$
$$ \vec{u}^{\ `} = \vec{u}^{(-)} + \vec{u}^{(-)} \ \times \ \vec{t}; $$
$$ \vec{t} = \vec{B} \cdot \dfrac{q \Delta t }{2 \cdot \gamma_{old} \ \cdot mc }; $$
$$
\vec{u}^{(-)} = \vec{u}_{old} + \vec{E} \cdot \dfrac{q \Delta t}{2mc};
$$
$$ \gamma_{old} = \sqrt{1 + | \ \vec{u}_{old} \ |^2 }; $$
$$ \vec{u}_{old} = \vec{p}_{old} \cdot \dfrac{1}{mc}. $$
Таким образом, схема Бориса преобразует имульс частицы $\vec{p}_{old}$ с предыдущей итерации в новое значение $\vec{p}_{new}$ - имульс частицы на текущей итерации. Переведя имульс $\vec{p}_{new}$ в скорость $\vec{v}_{new}$ , можем получить новое положение частицы $\vec{r}_{new}$ .

### Реализация

Метод `onUpdate()`, вызываемый ядром каждую итерацию симуляции, проходит по всем ячейкам сетки частиц, внутри каждой ячейки - по всем частицам. Обновление каждой частицы происходит в следующем порядке:

1. Из предоставляемого ядром контейнера поля берётся значение электромагнитного поля в точке 

### Тестирование

#### Графики сходимости метода Бориса

*Горизонталь: Временной Шаг (в сторону уменьшения)
*Вертикаль: Абсолютная ошибка;

##### Тест релятивистское ускорение в статическом поле

![](../Images/BorisA_L.png)


##### Тест Осцилляция в статическом поле

![](../Images/BorisO_L.png)

![](../Images/Trajectory_O.png)


##### Траектории

![](../Images/TrajectoryExample.png)

![](../Images/BorisTrajectoryExplanation.png)


### Ссылки:
* [Particle](../Basic/Particle.md)
* [Particle Grid](../Basic/Particle%20Grid.md)
* [Module](../Basic/Module.md)
* [Boris Trajectory Experiment](../Experiments/Boris%20Trajectory%20Experiment.md)